[[ package gen;

import java.util.*;

import se.rupy.http.*;
import se.rupy.memory.*;
import se.rupy.sprout.*;

public class content extends Sprout {
	public String path() { return "/content"; }
	public void filter(Event event) throws Event, Exception {
		Output out = event.output();
		Object key = event.session().get("key");
		Iterator articles = get("article").iterator();
		while(articles.hasNext()) {
			Article article = (Article) articles.next();
			Node user = (Node) article.get(Type.USER).getFirst();
			boolean edit = user.get(Type.USER_KEY).getValue().equals(key); ]]

    <div style="float: left; padding: 5px 5px 5px 5px;">
      <table>		
        <tr>
          <td colspan="2"><a class="title" href="article?id=[[ article.getId() ]]">[[ article.get(Type.ARTICLE_TITLE).getValue() ]]</a></td>
        </tr>
        <tr>
          <td><i>[[ article.time() ]]</i></td>
          <td align="right"><img src="res/comment.gif">&nbsp;<i>[[ article.get(Type.COMMENT).size() ]]</i>&nbsp;[[ i18n("Comments") ]]</td>
        </tr>
        <tr>
          <td colspan="2">

[[ print(article, out); ]]

          </td>
        </tr>
        <tr>
          <td>/[[ user.get(Type.USER_NAME).getValue() ]]</td>
          <td>

[[			if(edit) { ]]

            <div class="button" onclick="javascript:self.location = '/edit?id=[[ article.getId() ]]'">
              <p>[[ i18n("Edit") ]]</p>
            </div>

[[			} ]]

          </td>
        </tr>
      </table>
    </div>

[[ 		}
	}
	static void print(Article article, Output out) throws Exception {
		Iterator it = article.get(Type.FILE).iterator();
		if(it.hasNext()) {
			Node file = (Node) it.next(); ]]

          <div>
            <a class="title" href="article?id=[[ article.getId() ]]"><img src="[[ file.get(Type.FILE_PATH).getValue() + "/SMALL_" + file.get(Type.FILE_NAME).getValue() ]]" border="0"/></a>
          </div>

[[ 		}

		LinkedList columns = article.columnize();
		it = columns.iterator();
		if(it.hasNext()) {
			String column = (String) it.next(); ]]

          <div style="width: 200px;">
            [[ column ]]
            [[ if(columns.size() > 1) { ]]
            [[ "..." ]]
			[[ } ]]
          </div>

[[		}
	}
} ]]

