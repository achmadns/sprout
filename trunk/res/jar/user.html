[[ package gen;

import se.rupy.http.*;
import se.rupy.sprout.*;

import com.maxmind.geoip.*;

public class user extends Sprout {
	public int index() { return 2; }
	public String path() { return "/user:/register"; }
	public void filter(Event event) throws Event, Exception {
		Output out = event.output();
		String country = event.string("country");
		
		if(country.length() == 0) {
			country = User.lookup.getCountry(event.remote()).getCode();
		}
		
		if(country.equals("--")) {
			country = "";
		}

		event.daemon().chain("/header").filter(event); ]]

  <table>
    <form name="user" action="[[ event.query().path() ]]" method="post">

[[		if(event.string("error").length() > 0) { ]]

      <tr>
        <td colspan="3">
          <font color="red"><i>[[ event.string("error") ]]</i></font>
        </td>
      </tr>

[[		} ]]

      <tr>
        <td colspan="2"><font color="#F88017">[[ i18n("eMail") ]]</font>&nbsp;<font color="red">*</font>&nbsp;&nbsp;&nbsp;&nbsp;</td>
        <td colspan="2">
          <input type="text" class="mail" name="mail" value="[[ event.string("mail") ]]" style="text-transform: lowercase;" tabindex="1"/>
          <input type="checkbox" title="[[ i18n("Show eMail?") ]]" name="show_mail"[[ event.string("show_mail").equals("on") ? " checked" : "" ]]/>
        </td>
      </tr>
      <tr>
        <td colspan="2"><font color="#F88017">[[ i18n("Birthday") ]]</font>&nbsp;<font color="red">*</font>&nbsp;&nbsp;&nbsp;&nbsp;</td>
        <td colspan="2">
          <!-- // ISO 8601 -->
          <select name="year" class="year" tabindex="4">
            
[[		for(int i = 1900; i < 2009; i++) { ]]

            <option value="[[ i ]]"[[ event.query().medium("year", 1990) == i ? " selected" : "" ]]>[[ i ]]</option>

[[		} ]]

          </select>
          <select name="month" class="month" tabindex="3">
            
[[		for(int i = 1; i < 13; i++) { ]]

            <option value="[[ i ]]"[[ event.medium("month") == i ? " selected" : "" ]]>[[ i18n(User.month[i - 1]) ]]</option>

[[		} ]]

          </select>
          <select name="day" class="day" tabindex="2">
            
[[		for(int i = 1; i < 32; i++) { ]]

            <option value="[[ i ]]"[[ event.medium("day") == i ? " selected" : "" ]]>[[ i ]]</option>

[[		} ]]

          </select>
          <input type="checkbox" title="[[ i18n("Show birthday?") ]]" name="show_birthday"[[ event.string("show_birthday").equals("on") ? " checked" : "" ]]/>
        </td>
      </tr>
      <tr>
        <td colspan="2"><font color="#F88017">[[ i18n("Nickname") ]]</font>&nbsp;<font color="red">*</font>&nbsp;&nbsp;&nbsp;&nbsp;</td>
        <td>
          <input type="text" class="small" name="name" value="[[ event.string("name") ]]" style="text-transform: lowercase;" tabindex="5"/>
        </td>
        <td rowspan="3" width="100">
          <table>
            <tr>
              <td>
                <img src="res/female.png" alt="[[ i18n("Female") ]]"/>
              </td>
              <td>
                <img src="res/male.png" alt="[[ i18n("Male") ]]"/>
              </td>
              <!--td>
                <input type="checkbox" name="show_gender"[[ event.string("show_gender").equals("on") ? " checked" : "" ]]/>
              </td-->
            </tr>
            <tr>
              <td align="center">
                <input type="radio" title="[[ i18n("Female") ]]" name="gender" value="female" tabindex="11"[[ event.string("gender").equals("female") ? " checked" : "" ]]/>
              </td>
              <td align="center">
                <input type="radio" title="[[ i18n("Male") ]]" name="gender" value="male" tabindex="12"[[ event.string("gender").equals("male") ? " checked" : "" ]]/>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td colspan="2"><font color="#F88017">[[ i18n("Password") ]]</font>&nbsp;<font color="red">*</font>&nbsp;&nbsp;&nbsp;&nbsp;</td>
        <td>
          <input type="password" class="small" name="pass" value="[[ event.string("pass") ]]" tabindex="6"/>
        </td>
      </tr>
      <tr>
        <td colspan="2"><font color="#F88017">[[ i18n("Confirm") ]]</font>&nbsp;<font color="red">*</font>&nbsp;&nbsp;&nbsp;&nbsp;</td>
        <td>
          <input type="password" class="small" name="word" value="[[ event.string("word") ]]" onkeypress="return myKeyPressed(event)" tabindex="7"/>
        </td>
      </tr>
      <tr>
        <td><font color="#3B9C9C">[[ i18n("Country") ]]</font>&nbsp;&nbsp;&nbsp;&nbsp;</td>
        <td width="16"><img id="flag" src="res/flag/[[ country.toLowerCase() ]].png" align="right" style="vertical-align: middle;[[ out.print(country.length() == 0 ? " display: none;" : ""); ]]"/></td>
        <td>
          <select name="country" class="medium" onChange="changeFlag(this);" tabindex="8">
            <option value="--">N/A</option>
            
[[		for(int i = 0; i < User.countryCode.length; i++) { ]]

            <option value="[[ User.countryCode[i] ]]"[[ country.equals(User.countryCode[i]) ? " selected" : "" ]]>[[ User.countryName[i] ]]</option>

[[		} ]]

          </select>
        </td>
        <td>
          <input type="checkbox" title="[[ i18n("Show country?") ]]" name="show_country"[[ event.string("show_country").equals("on") ? " checked" : "" ]]/>
        </td>
      </tr>
      <tr>
        <td colspan="2"><font color="#3B9C9C">[[ out.print(i18n("First&nbsp;Name")); ]]</font>&nbsp;&nbsp;&nbsp;&nbsp;</td>
        <td>
          <input type="text" class="small" name="first" value="[[ event.string("first") ]]" tabindex="9"/>
        </td>
        <td>
          <input type="checkbox" title="[[ i18n("Show first name?") ]]" name="show_first_name"[[ event.string("show_first_name").equals("on") ? " checked" : "" ]]/>
        </td>
      </tr>
      <tr>
        <td colspan="2"><font color="#3B9C9C">[[ out.print(i18n("Last&nbsp;Name")); ]]</font>&nbsp;&nbsp;&nbsp;&nbsp;</td>
        <td>
          <input type="text" class="small" name="last" value="[[ event.string("last") ]]" tabindex="10"/>
        </td>
        <td>
          <input type="checkbox" title="[[ i18n("Show last name?") ]]" name="show_last_name"[[ event.string("show_last_name").equals("on") ? " checked" : "" ]]/>
        </td>
      </tr>
      <tr>
        <td colspan="3">
          <a href="" class="arrow" onclick="document.user.submit(); return false;">
            <span>[[ event.query().path().equals("/user") ? i18n("Save") : i18n("Create") ]]</span>
          </a>
        </td>
      </tr>
    </form>
  </table>
</div>
</body>
</html>

[[ } 
} ]]

